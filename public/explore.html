<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Explore Destinations | Tripease Explorer</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:"Poppins",sans-serif}
    body{
      background:url('https://images.unsplash.com/photo-1506744038136-46273834b3fb') no-repeat center/cover;
      color:#fff;overflow-x:hidden;padding-bottom:60px;
    }
    header{
      width:90%;margin:20px auto;padding:12px 20px;background:rgba(255,255,255,.12);
      border-radius:40px;display:flex;justify-content:space-between;align-items:center;
      backdrop-filter:blur(8px);border:1px solid rgba(255,255,255,.2)
    }
    nav a{text-decoration:none;color:#000;margin:0 10px;font-weight:600}
    nav a:hover{color:#00b3b3}
    .search-row{width:90%;margin:22px auto;display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .search-row input,.search-row select{padding:10px;border-radius:10px;border:1px solid rgba(0,0,0,.06);min-width:180px}
    .btn{background:#00b3b3;color:#fff;border:none;padding:10px 14px;border-radius:10px;cursor:pointer}
    .panel{width:90%;margin:0 auto;background:rgba(255,255,255,.12);border-radius:12px;padding:14px;border:1px solid rgba(255,255,255,.12)}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:18px;margin-top:14px}
    .card{background:#fff;color:#000;border-radius:12px;overflow:hidden;box-shadow:0 8px 24px rgba(0,0,0,.12)}
    .card img{width:100%;height:160px;object-fit:cover;display:block}
    .card .body{padding:12px}
    .card h3{margin:0 0 6px;font-size:18px}
    .card p{margin:0;color:#444;font-size:13px}
    .meta{font-size:12px;color:#666;margin-top:8px}
    #message{width:90%;margin:16px auto;color:#fff;text-align:center}
    footer{text-align:center;padding:24px;color:#fff;opacity:.9}
    @media (max-width:520px){ .search-row{flex-direction:column;align-items:stretch} }
  </style>
</head>
<body>
  <header>
    <div style="display:flex;align-items:center;gap:14px">
      <a href="index.html" style="font-weight:700;color:#00b3b3;text-decoration:none">Tripease</a>
      <nav>
        <a href="index.html">Home</a>
        <a href="explore.html" style="color:#00b3b3">Explore</a>
        <a href="contact.html">Contact</a>
      </nav>
    </div>

    <div style="display:flex;gap:10px;align-items:center">
      <button onclick="location.href='index.html'" class="btn" style="background:transparent;color:#fff;border:1px solid #fff">Back Home</button>
    </div>
  </header>

  <main>
    <section class="search-row">
      <input id="dest-keyword" type="text" placeholder="Search destinations (city, landmark, beach)..." />
      <select id="dest-subtype">
        <option value="CITY">City</option>
        <option value="AIRPORT">Airport</option>
        <option value="POINT_OF_INTEREST">Point of Interest</option>
        <option value="NEIGHBORHOOD">Neighborhood</option>
        <option value="ALL">All</option>
      </select>
      <input id="dest-limit" type="number" value="2" min="1" max="20" style="width:90px" />
      <button id="dest-search" class="btn">Search</button>
      <button id="dest-random" class="btn" style="background:#fff;color:#000">Surprise me</button>
    </section>

    <div id="message"></div>

    <section class="panel">
      <h2 style="margin:0 0 8px;color:#fff">Results</h2>
      <div id="dest-grid" class="grid" aria-live="polite"></div>
    </section>
  </main>

  <footer>Â© 2025 Tripease Explorer</footer>

  <script>
    const API_DEST = '/api/destinations';
    const grid = document.getElementById('dest-grid');
    const msg = document.getElementById('message');
    const keywordEl = document.getElementById('dest-keyword');
    const subtypeEl = document.getElementById('dest-subtype');
    const limitEl = document.getElementById('dest-limit');
    const searchBtn = document.getElementById('dest-search');
    const randomBtn = document.getElementById('dest-random');

    function showMessage(txt, isError = false) {
      msg.textContent = txt || '';
      msg.style.color = isError ? '#ffdddd' : '#dfffe6';
    }

    function clearMessage(){ showMessage(''); }

    // ---------- NEW: smarter image resolver ----------
    const IMAGE_OVERRIDES = {
      // key: lowercase substring to match in name/region
      'goa': 'https://images.unsplash.com/photo-1560179406-1c6c60e0dc76?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NHx8Z29hfGVufDB8fDB8fHww',
      'kolkata': 'https://images.unsplash.com/photo-1603813507806-0d311a6eecd1?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8N3x8a29sa2F0YXxlbnwwfHwwfHx8MA%3D%3D',
      'rajasthan': 'https://images.unsplash.com/photo-1599661046289-e31897846e41?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8cmFqYXN0aGFufGVufDB8fDB8fHww',
      'jaipur': 'https://images.unsplash.com/photo-1602643163983-ed0babc39797?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8cmFqYXN0aGFufGVufDB8fDB8fHww',
      'udaipur': 'https://images.unsplash.com/photo-1615836245337-f5b9b2303f10?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8dWRhaXB1cnxlbnwwfHwwfHx8MA%3D%3D',
      'himachal': 'https://images.unsplash.com/photo-1581791534721-e599df4417f7?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8M3x8aGltYWNoYWx8ZW58MHx8MHx8fDA%3D',
      'manali': 'https://images.unsplash.com/photo-1712388430474-ace0c16051e2?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8bWFuYWxpfGVufDB8fDB8fHww',
      'andaman': 'https://images.unsplash.com/photo-1642498232612-a837df233825?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NHx8YW5kYW1hbnxlbnwwfHwwfHx8MA%3D%3D',
      'maldives': 'https://images.unsplash.com/photo-1573843981267-be1999ff37cd?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8bWFsZGl2ZXN8ZW58MHx8MHx8fDA%3D',
      'bali': 'https://images.unsplash.com/photo-1537996194471-e657df975ab4?q=80&w=438&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D',
      'paris': 'https://images.unsplash.com/photo-1511739001486-6bfe10ce785f?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8cGFyaXN8ZW58MHx8MHx8fDA%3D',
      'santorini': 'https://images.unsplash.com/photo-1580502304784-8985b7eb7260?w=500&auto=format&fit=crop&q=60&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Nnx8c2FudG9yaW5pfGVufDB8fDB8fHww'
    };

    function getImageForDestination(item){
      // 1) If API already gave image, use it
      if (item.imageUrl) return item.imageUrl;
      if (item.image) return item.image;

      const rawName = String(item.name || item.title || '').toLowerCase();
      const rawRegion = String(item.region || item.address?.cityName || item.address?.countryName || '').toLowerCase();

      // 2) If name/region contains known key, use curated image
      for (const key in IMAGE_OVERRIDES){
        if (rawName.includes(key) || rawRegion.includes(key)){
          return IMAGE_OVERRIDES[key];
        }
      }

      // 3) Otherwise use a dynamic Unsplash query based on place name + region
      const qParts = [];
      if (item.name) qParts.push(item.name);
      if (item.region) qParts.push(item.region);
      if (item.address?.countryName) qParts.push(item.address.countryName);
      qParts.push('travel');

      const query = encodeURIComponent(qParts.filter(Boolean).join(' '));
      // Unsplash Source: random photo related to query
      return `https://source.unsplash.com/800x600/?${query}`;
    }

    function cardHtml(item){
      const img = getImageForDestination(item);
      const name = item.name || item.title || 'Unknown';
      const region = item.region || item.address?.countryName || '';
      const desc = item.description || (item.raw && item.raw.detailedName) || '';
      return `
        <article class="card" role="article" aria-label="${name}">
          <img src="${img}" alt="${name}" onerror="this.onerror=null;this.src='https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?auto=format&fit=crop&w=1200&q=80'"/>
          <div class="body">
            <h3>${escapeHtml(name)}</h3>
            <div class="meta">${escapeHtml(region)}</div>
            <p>${escapeHtml(desc)}</p>
          </div>
        </article>
      `;
    }

    function escapeHtml(str){
      if(!str) return '';
      return String(str)
        .replaceAll('&','&amp;')
        .replaceAll('<','&lt;')
        .replaceAll('>','&gt;')
        .replaceAll('"','&quot;')
        .replaceAll("'",'&#39;');
    }

    async function fetchDestinations({keyword='', subType='CITY', limit=8} = {}){
      try{
        showMessage('Searching...');
        grid.innerHTML = '';
        const q = new URLSearchParams();
        if(keyword) q.set('keyword', keyword);
        if(subType && subType !== 'ALL') q.set('subType', subType);
        q.set('limit', String(limit || 8));
        const res = await fetch(API_DEST + '?' + q.toString());
        if(!res.ok){
          await res.json().catch(()=>null); // just to consume body if needed
          showMessage('No destinations (external API unavailable). Showing suggestions below.', true);
          return [];
        }
        const json = await res.json();
        return Array.isArray(json.data) ? json.data : [];
      }catch(err){
        console.error('fetchDestinations error', err);
        showMessage('Failed to fetch destinations. Try again later.', true);
        return [];
      }
    }

    async function renderDestinations(params){
      try{
        clearMessage();
        const list = await fetchDestinations(params);
        if(!list || !list.length){
          grid.innerHTML = '<div style="color:#fff;padding:28px">No destinations found.</div>';
          return;
        }
        grid.innerHTML = list.map(cardHtml).join('');
      }catch(err){
        console.error(err);
        grid.innerHTML = '<div style="color:#fff;padding:28px">Error rendering destinations.</div>';
      }
    }

    searchBtn.addEventListener('click', ()=>{
      const kw = keywordEl.value.trim();
      const sub = subtypeEl.value;
      const lim = Number(limitEl.value) || 8;
      renderDestinations({keyword: kw, subType: sub, limit: lim});
    });

    keywordEl.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter') searchBtn.click();
    });

    randomBtn.addEventListener('click', async ()=>{
      // small list of sample keywords to show varied results
      const samples = ['goa','kolkata','rajasthan','himachal','andaman','beach','mountain','historic','temple','island'];
      const pick = samples[Math.floor(Math.random()*samples.length)];
      keywordEl.value = pick;
      subtypeEl.value = 'CITY';
      renderDestinations({keyword: pick, subType: 'CITY', limit: 12});
    });

    // Load initial destinations (popular-ish)
    (function init(){
      renderDestinations({keyword:'beach', subType:'CITY', limit:8});
    })();
  </script>
</body>
</html>
